{% extends "base.html" %}

{% block title %}Business Startup Activities{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Business Startup Activities</h2>
        <span class="badge bg-primary fs-6" id="total-weight-badge">Total Weight: {{ total_weight }}%</span>
    </div>
    <p>List and prioritize the core activities required to launch your business. The total weight cannot exceed 100%.
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('main.startup_activities') }}">
        <div class="table-responsive">
            <table class="table table-bordered" id="activities-table">
                <thead class="table-light">
                    <tr>
                        <th style="width: 25%;">Activity</th>
                        <th style="width: 25%;">Description</th>
                        <th style="width: 10%;">Weight (%)</th>
                        <th style="width: 20%;">Progress</th>
                        <th style="width: 10%;" class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in activities %}
                    <tr>
                        <td>
                            <input type="hidden" name="id" value="{{ item.id or '' }}">
                            <input type="text" name="activity" class="form-control" value="{{ item.activity }}"
                                title="{{ item.activity }}" required>
                        </td>
                        <td><input type="text" name="description" class="form-control" value="{{ item.description }}"
                                title="{{ item.description }}">
                        </td>
                        <td><input type="number" name="weight" class="form-control weight-input"
                                value="{{ item.weight }}" min="0" max="100" required></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <input type="range" name="progress" class="form-range progress-slider" min="0" max="100"
                                    step="1" value="{{ item.progress }}">
                                <span class="ms-2 progress-value fw-bold">{{ item.progress }}%</span>
                            </div>
                        </td>
                        <td class="text-center">
                            <i class="bi bi-trash-fill text-danger remove-row-btn"
                                style="cursor: pointer; font-size: 1.2rem;" title="Remove item"></i>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-3">
            <button type="button" id="add-row-btn" class="btn btn-secondary">Add Activity</button>
            <div class="float-end">
                <button type="submit" name="action" value="save_and_continue" class="btn btn-success">Save and Continue
                    &rarr;</button>
            </div>
        </div>
    </form>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='scripts/startup_activities.js') }}"></script>
{% endblock %}